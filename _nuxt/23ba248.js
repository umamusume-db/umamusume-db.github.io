(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{272:function(t,e,n){var c=n(3),o=n(183).values;c({target:"Object",stat:!0},{values:function(t){return o(t)}})},279:function(t,e,n){n(187)("Float32",(function(t){return function(data,e,n){return t(this,data,e,n)}}))},280:function(t,e,n){n(187)("Uint16",(function(t){return function(data,e,n){return t(this,data,e,n)}}))},281:function(t,e,n){"use strict";var c=n(3),o=n(2),r=n(134),l=n(102),d="ArrayBuffer",h=r.ArrayBuffer;c({global:!0,forced:o.ArrayBuffer!==h},{ArrayBuffer:h}),l(d)},282:function(t,e,n){var c=n(3),o=n(134);c({global:!0,forced:!n(136)},{DataView:o.DataView})},287:function(t,e,n){"use strict";n.r(e);var c=n(16),o=n(4),r=(n(43),n(272),n(182),n(29),n(188),n(15),n(279),n(190),n(191),n(192),n(193),n(194),n(195),n(196),n(197),n(198),n(199),n(200),n(201),n(202),n(203),n(204),n(205),n(206),n(207),n(208),n(209),n(214),n(215),n(216),n(18),n(23),n(135),n(280),n(189),n(281),n(282),n(82),n(28),{asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var n,c,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$getFetchData,t.error,c=["BasicLiveDataInfo","LivePermissionData","BasicCharaDataInfo"],e.next=4,n(c);case 4:return o=e.sent,e.abrupt("return",{basicLiveData:o.BasicLiveDataInfo,livePermissionData:o.LivePermissionData,basicCharaData:o.BasicCharaDataInfo,selectedSongId:0,voiceDict:{},volumeDict:{},context:new AudioContext});case 6:case"end":return e.stop()}}),e)})))()},computed:{c_chara_list:function(){var t=this,e=Object.values(this.basicCharaData).filter((function(e){return 1001===t.selectedSongId||1006===t.selectedSongId?e.cardId:Object.values(t.livePermissionData).find((function(n){return n.musicId===t.selectedSongId&&n.charaId===e.charaId}))}),this),n=[];return e.forEach((function(t){n.find((function(e){return e.charaId===t.charaId}))||n.push(t)})),n}},methods:{m_mix:function(t,e){for(var n=t.length,c=0,o=0,i=0;i<n;i++)t[i].numberOfChannels>c&&(c=t[i].numberOfChannels),t[i].duration>o&&(o=t[i].duration);for(var r=this.context.createBuffer(c,this.context.sampleRate*o,this.context.sampleRate),l=0;l<n;l++)for(var d=0;d<t[l].numberOfChannels;d++){var h=r.getChannelData(d),m=t[l].getChannelData(d);for(i=0;i<m.length;i++)h[i]+=m[i]*e[l]}return r},m_export:function(t){for(var e=[t.getChannelData(0),t.getChannelData(1)],n=e[0],c=e[1],o=new Float32Array(n.length+c.length),r=0,l=0;r<n.length;r++,l+=2)o[l]=n[r],o[l+1]=c[r];var d=function(t,e){var n=e.isFloat?Float32Array:Uint16Array,c=t.byteLength/n.BYTES_PER_ELEMENT,o=function(t){var e=t.numFrames,n=t.numChannels||2,c=t.sampleRate||44100,o=t.isFloat?4:2,r=t.isFloat?3:1,l=n*o,d=c*l,h=e*l,m=new ArrayBuffer(44),v=new DataView(m),p=0;function _(s){for(var i=0;i<s.length;i++)v.setUint8(p+i,s.charCodeAt(i));p+=s.length}function f(t){v.setUint32(p,t,!0),p+=4}function I(t){v.setUint16(p,t,!0),p+=2}return _("RIFF"),f(h+36),_("WAVE"),_("fmt "),f(16),I(r),I(n),f(c),f(d),I(l),I(8*o),_("data"),f(h),new Uint8Array(m)}(Object.assign({},e,{numFrames:c})),r=new Uint8Array(o.length+t.byteLength);return r.set(o,0),r.set(new Uint8Array(t),o.length),r}(o.buffer,{isFloat:!0,numChannels:2,sampleRate:48e3}),h=new Blob([d],{type:"audio/wav"}),m=document.createElement("a");m.href=URL.createObjectURL(h),m.setAttribute("download","song_"+this.selectedSongId+"_time_"+Date.now()+".wav"),m.click()},m_url_vol_list:function(){var t=this,e=[];return console.log(),!0===this.voiceDict[this.selectedSongId+"_instrumental"]&&e.push([this.c_chara_list.length?"https://umadb.skyset.eu/assets/sound/l/".concat(this.selectedSongId,"/snd_bgm_live_").concat(this.selectedSongId,"_oke_01.awb_1.webm"):"https://umadb.skyset.eu/assets/sound/b/snd_bgm_cs".concat(this.selectedSongId,"_gamesize.awb_1.webm"),this.volumeDict[this.selectedSongId+"_instrumental"]/100]),this.c_chara_list.forEach((function(n){var c=t.selectedSongId+"_"+n.charaId;!0===t.voiceDict[c]&&(e.push(["https://umadb.skyset.eu/assets/sound/l/".concat(t.selectedSongId,"/snd_bgm_live_").concat(t.selectedSongId,"_chara_").concat(n.charaId,"_01.awb_1.webm"),t.volumeDict[c]/100]),1032===t.selectedSongId&&e.push(["https://umadb.skyset.eu/assets/sound/l/".concat(t.selectedSongId,"/snd_bgm_live_").concat(t.selectedSongId,"_chara_").concat(n.charaId,"_01.awb_2.webm"),t.volumeDict[c]/100]))}),this),e},m_play:function(){var t=this,e=this.m_url_vol_list(),n=[],o=[],r=0;e.forEach((function(e,l,d){var h=Object(c.a)(e,2),m=h[0],v=h[1];window.fetch(m).then((function(t){return t.arrayBuffer()})).then((function(e){return t.context.decodeAudioData(e)})).then((function(e){if(o.push(v||1),n.push(e),(r+=1)===d.length){t.m_stop();var source=t.context.createBufferSource();source.buffer=t.m_mix(n,o),source.connect(t.context.destination),source.start()}}))}))},m_stop:function(){this.context.close(),this.context=new AudioContext},m_download:function(){var t=this,e=this.m_url_vol_list(),n=[],o=[],r=0;e.forEach((function(e,l,d){var h=Object(c.a)(e,2),m=h[0],v=h[1];window.fetch(m).then((function(t){return t.arrayBuffer()})).then((function(e){return t.context.decodeAudioData(e)})).then((function(e){o.push(v||1),n.push(e),(r+=1)===d.length&&t.m_export(t.m_mix(n,o))}))}))}}}),l=n(27),component=Object(l.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container-fluid"},[n("div",{staticClass:"d-flex w-100 pt-4 pb-3 px-5 sticky-top bg-dark"},[n("div",{staticClass:"input-group border rounded"},[n("button",{staticClass:"input-group-text btn-dark",attrs:{disabled:""}},[t._v("Song")]),t._v(" "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedSongId,expression:"selectedSongId"}],staticClass:"form-select btn-dark border-start border-end",on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.selectedSongId=e.target.multiple?n:n[0]}}},[n("option",{attrs:{value:"0",disabled:"",selected:""}},[t._v("Select a song...")]),t._v(" "),t._l(t.basicLiveData,(function(e){return n("option",{key:e.musicId,domProps:{value:e.musicId}},[t._v(t._s(e.songName))])}))],2),t._v(" "),n("button",{staticClass:"input-group-text btn-dark",on:{click:t.m_play}},[t._v("Play")]),t._v(" "),n("button",{staticClass:"input-group-text btn-dark border-start",on:{click:t.m_stop}},[t._v("\n        Stop\n      ")]),t._v(" "),n("button",{staticClass:"input-group-text btn-dark border-start",on:{click:t.m_download}},[t._v("\n        Download\n      ")])])]),t._v(" "),n("div",[n("transition-group",{directives:[{name:"show",rawName:"v-show",value:t.selectedSongId,expression:"selectedSongId"}],staticClass:"border rounded g-0 p-0 m-0",attrs:{name:"transition-list",tag:"ul"}},[n("li",{directives:[{name:"show",rawName:"v-show",value:t.selectedSongId,expression:"selectedSongId"}],key:"instrumental",staticClass:"row g-0 align-items-center p-2"},[n("img",{staticClass:"px-3 col-3",staticStyle:{height:"100%",width:"100%","max-height":"135px","max-width":"135px","object-fit":"contain"},attrs:{src:"https://umadb.skyset.eu/assets/live/jacket/jacket_icon_l_"+t.selectedSongId+".webp",alt:"Instrumental"}}),t._v(" "),n("h3",{staticClass:"text-white col-4"},[t._v("\n          "+t._s(this.c_chara_list.length?"Instrumental":"Jukebox song")+"\n        ")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.voiceDict[t.selectedSongId+"_instrumental"],expression:"voiceDict[selectedSongId + '_instrumental']"}],staticClass:"btn-check",attrs:{type:"checkbox",id:"btn-check-instrumental",autocomplete:"off"},domProps:{checked:Array.isArray(t.voiceDict[t.selectedSongId+"_instrumental"])?t._i(t.voiceDict[t.selectedSongId+"_instrumental"],null)>-1:t.voiceDict[t.selectedSongId+"_instrumental"]},on:{change:function(e){var n=t.voiceDict[t.selectedSongId+"_instrumental"],c=e.target,o=!!c.checked;if(Array.isArray(n)){var r=t._i(n,null);c.checked?r<0&&t.$set(t.voiceDict,t.selectedSongId+"_instrumental",n.concat([null])):r>-1&&t.$set(t.voiceDict,t.selectedSongId+"_instrumental",n.slice(0,r).concat(n.slice(r+1)))}else t.$set(t.voiceDict,t.selectedSongId+"_instrumental",o)}}}),t._v(" "),n("label",{staticClass:"btn btn-outline-secondary col-2 mx-2",attrs:{for:"btn-check-instrumental"}},[t._v("Voice")]),t._v(" "),n("div",{staticClass:"col m-2 mx-5"},[n("p",{staticClass:"text-white text-center m-0"},[t._v("\n            Volume :\n            "+t._s(t.volumeDict[t.selectedSongId+"_instrumental"]?t.volumeDict[t.selectedSongId+"_instrumental"]:100)+"%\n          ")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.volumeDict[t.selectedSongId+"_instrumental"],expression:"volumeDict[selectedSongId + '_instrumental']"}],staticClass:"w-100",attrs:{type:"range",min:"0",max:"200",step:"5"},domProps:{value:t.volumeDict[t.selectedSongId+"_instrumental"]},on:{__r:function(e){return t.$set(t.volumeDict,t.selectedSongId+"_instrumental",e.target.value)}}})])]),t._v(" "),t._l(t.c_chara_list,(function(e){return n("li",{key:e.charaId,staticClass:"transition-list-item row g-0 align-items-center border-top p-2"},[n("img",{staticClass:"px-3 col-3",staticStyle:{height:"100%",width:"100%","max-height":"135px","max-width":"135px","object-fit":"contain"},attrs:{src:"https://umadb.skyset.eu/assets/chara/chr"+e.charaId+"/chr_icon_"+e.charaId+".webp",alt:e.charaName}}),t._v(" "),n("div",{staticClass:"col-4"},[n("h3",{staticClass:"text-white"},[t._v(t._s(e.charaName))]),t._v(" "),n("h5",{staticClass:"text-white"},[t._v("CV : "+t._s(e.charaCv))])]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.voiceDict[t.selectedSongId+"_"+e.charaId],expression:"voiceDict[selectedSongId + '_' + chara.charaId]"}],staticClass:"btn-check position-absolute top-0",attrs:{type:"checkbox",id:"btn-check-"+e.charaId,autocomplete:"off"},domProps:{checked:Array.isArray(t.voiceDict[t.selectedSongId+"_"+e.charaId])?t._i(t.voiceDict[t.selectedSongId+"_"+e.charaId],null)>-1:t.voiceDict[t.selectedSongId+"_"+e.charaId]},on:{change:function(n){var c=t.voiceDict[t.selectedSongId+"_"+e.charaId],o=n.target,r=!!o.checked;if(Array.isArray(c)){var l=t._i(c,null);o.checked?l<0&&t.$set(t.voiceDict,t.selectedSongId+"_"+e.charaId,c.concat([null])):l>-1&&t.$set(t.voiceDict,t.selectedSongId+"_"+e.charaId,c.slice(0,l).concat(c.slice(l+1)))}else t.$set(t.voiceDict,t.selectedSongId+"_"+e.charaId,r)}}}),t._v(" "),n("label",{staticClass:"btn btn-outline-secondary col-2 mx-2",attrs:{for:"btn-check-"+e.charaId}},[t._v("Voice")]),t._v(" "),n("div",{staticClass:"col m-2 mx-5",staticStyle:{"min-width":"120px"}},[n("p",{staticClass:"text-white text-center m-0"},[t._v("\n            Volume :\n            "+t._s(t.volumeDict[t.selectedSongId+"_"+e.charaId]?t.volumeDict[t.selectedSongId+"_"+e.charaId]:100)+"%\n          ")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.volumeDict[t.selectedSongId+"_"+e.charaId],expression:"volumeDict[selectedSongId + '_' + chara.charaId]"}],staticClass:"w-100",attrs:{type:"range",min:"0",max:"200",step:"5"},domProps:{value:t.volumeDict[t.selectedSongId+"_"+e.charaId]},on:{__r:function(n){return t.$set(t.volumeDict,t.selectedSongId+"_"+e.charaId,n.target.value)}}})])])}))],2)],1)])}),[],!1,null,null,null);e.default=component.exports}}]);